{
  "unpublishedCollection": {
    "name": "Data",
    "pageId": "Travel Dashboard",
    "pluginId": "js-plugin",
    "pluginType": "JS",
    "actions": [],
    "archivedActions": [],
    "body": "export default {\n\tCurrentUserId: () => { return GetAllUsers.data.find(x => x.Name === appsmith.store.currentUser).Id },\n\tUpdateAll: async () => {\n\t\tawait GetAllUsers.run();\n\t\tawait GetAllAverages.run();\n\t},\n\tGetUsersAverages: () => {\n\t\tlet users = GetAllUsers.data;\n\t\tlet averages = GetAllAverages.data;\n\t\treturn users.map(u => {\n\t\t\tu.Averages = averages.filter(a => a.UserId === u.Id);\n\t\t\treturn u;\n\t\t});\n\t},\n\tGetUser: (id) => { return Data.GetUsersAverages().find(u => u.Id === id) },\n\tGetCurrentUser: () => { return Data.GetUser(Data.CurrentUserId()); },\n\tGetUsersOfCountry: (country) => {\n\t\treturn Data.GetUsersAverages().filter(u => u.Country === country);\n\t},\n\tGetCountries: () => {\n\t\treturn GetAllUsers.data.map(u => u.Country).filter((v, i, s) => s.indexOf(v) == i);\n\t},\n\tGetCurrentUserAverageSpending: () => {\n\t\tlet sum = 0;\n\t\tData.GetCurrentUser().Averages.forEach(a => sum += a.Sum);\n\t\treturn Math.ceil(sum / Data.GetCurrentUser().Averages.length);\n\t},\n\tGetAverageSpendingInCountry: (country) => {\n\t\tlet averages = Data.GetUsersOfCountry(country).map(u => {\n\t\t\tlet sum = 0, n = 0;\n\t\t\tu.Averages.forEach(a => {\n\t\t\t\tif(a.Sum !== 0) {\n\t\t\t\t\tsum += a.Sum;\n\t\t\t\t\tn++;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn sum / n;\n\t\t}).filter(s => s).sort().reverse();\n\t\tlet sum = 0;\n\t\taverages.forEach(a => sum += a);\n\t\treturn Math.ceil(sum / averages.length);\n\t},\n\tGetCategories: () => {\n\t\treturn Data.GetCurrentUser().Averages.map(o => Object.keys(o))[0].filter(c => c !== \"Id\" && c !== \"UserId\" && c !== \"rowIndex\" && c !== \"Sum\" && c !== \"Month\");\n\t},\n\tGetAverageSpendingCategoriesInCountry: (country) => {\n\t\tlet averages = Data.GetUsersOfCountry(country).map(u => {\n\t\t\tlet x = {};\n\t\t\tData.GetCategories().forEach(c => {\n\t\t\t\tlet sum = 0;\n\t\t\t\tu.Averages.forEach(a => sum += a[c]);\n\t\t\t\tx[c] = sum / u.Averages.length;\n\t\t\t});\n\t\t\treturn x;\n\t\t});\n\t\tlet y = {};\n\t\tData.GetCategories().forEach(c => {\n\t\t\tlet sum = 0;\n\t\t\tlet n = 0;\n\t\t\taverages.forEach(a => {\n\t\t\t\tif(a[c])\n\t\t\t\t\tsum += a[c];\n\t\t\t\tn++;\n\t\t\t});\n\t\t\ty[c] = Math.ceil(sum / n);\n\t\t});\n\t\treturn y;\n\t},\n\tGetTopSpendingCategories: (country) => {\n\t\tlet averages = Data.GetAverageSpendingCategoriesInCountry(country);\n\t\tlet values = Object.values(averages);\n\t\tlet keys = Object.keys(averages);\n\t\treturn keys.map((k, i) => {return [values[i], k]}).sort().reverse().slice(0, 3);\n\t},\n\tGetTopSpendingCategoriesGraph: (country) => {\n\t\treturn Data.GetTopSpendingCategories(\"Portugal\").map(x => {return {x: x[1], y: x[0]}});\n\t},\n\tGetTopSpendingCategoriesUser: (country) => {\n\t\tlet avg = Data.GetCurrentUser().Averages;\n\t\tlet user_averages = {};\n\t\tData.GetCategories().forEach(c => {\n\t\t\tlet sum = 0, n = 0;\n\t\t\tavg.forEach(a => {\n\t\t\t\tif(a[c])\n\t\t\t\t\tsum += a[c];\n\t\t\t\tn++;\n\t\t\t});\n\t\t\tuser_averages[c] = Math.ceil(sum / n);\n\t\t});\n\t\treturn Data.GetTopSpendingCategories(\"Portugal\").map(x => {return {x: x[1], y: user_averages[x[1]]}});\n\t}\n}",
    "variables": []
  },
  "id": "Travel Dashboard_Data",
  "deleted": false,
  "gitSyncId": "6353c0894b1a8d4291236e5b_6354075bdc264920d5e26eeb"
}